# 2K1000上板过程问题

## UART地址设置

UART0寄存器（映射）基址：0x8000_0000_1fe2_0000

出处：U-Boot源码解析（龙芯版）章节5.3.2。指向U-Boot源码：u-boot-2022.04-2k1000
```asm
/arch/loongarch/mach-loongson/ls2k100/lowlevel_init.S:394

#define UART_REF_CLK	125000000
#define UART_DIV_HI	 (((UART_REF_CLK + (115200*8)) / (115200*16)) >> 8)
#define UART_DIV_LO	(((UART_REF_CLK + (115200*8)) / (115200*16)) & 0xff)
ENTRY(init_serial)
	or  a4, ra, zero      /*返回地址写入a4*/

	li.d	a0, CONSOLE_BASE_ADDR
    /*UART0寄存器（映射）基址：0x8000_0000_1fe2_0000*/
    /*/include/configs/loongson_2k1000.h*/
    /*/arch/loongarch/mach-loongson/include/mach/ls2k1000/ls2k1000.h*/
```

## NAND_BASE与DMA_ADDR

NAND_BASE: usize = 0x1fe2_6000 | HIGH_BASE_EIGHT;
DMA_ADDR: usize = 0x1fe0_0c00 | HIGH_BASE_EIGHT;

出处：U-Boot源码解析（龙芯版）章节9.5.1。

通过搜索NAND找到的，在U-Boot源码中也得到了验证，观察其中的reg项可以找到地址。

在2K500：
```
arch/loongarch/dts/ls2k500.dtsi

577行：
nand: nand-controller@1ff58000 {
    compatible = "loongson,ls-nand";
    reg = <0 0x1ff58000 0 0x4000>;
    pinctrl-names = "default";
    pinctrl-0 = <&nand_pins>;
    dmas = <&dma0 0>;
    dma-names = "nand-rw";
    nand-cs-origin = <0>;
    nand-ecc-algo = "bch";  // "bch", "none"
    nand-ecc-strength = <4>;
    status = "disabled";
};

342行：
dma0: dma@1fe10c00 {
    compatible = "loongson,ls2k500-dma";
    reg = <0 0x1fe10c00 0 0x4>;
    dma-cfg = <&dmacfg 0 LS_DMA_OWNER_NAND>; // arg[0]: channel id  arg[1]: dma owner
    #dma-cells = <1>;
    dma-channels = <1>;
    dma-requests = <1>;
};
```
在2K1000：
```
arch/loongarch/dts/ls2k1000.dtsi

505行：
nand: nand-controller@1fe26000 {
    compatible = "loongson,ls-nand";
    reg = <0 0x1fe26000 0 0x44>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinmux_nand_nand>;
    dmas = <&dma0 0>;
    dma-names = "nand-rw";
    nand-cs-origin = <2>;
    nand-ecc-algo = "bch";  // "bch", "none"
    nand-ecc-strength = <4>;
    status = "disabled";
};

379行：
dma0: dma@1fe00c00 {
    compatible = "loongson,ls2k1000-dma";
    reg = <0 0x1fe00c00 0 0x8>;
    dma-cfg = <&dmacfg 0 LS_DMA_OWNER_NAND>; // arg[0]: channel id  arg[1]: dma owner
    #dma-cells = <1>;
    dma-channels = <1>;
    dma-requests = <1>;
};
```